<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>דשבורד ניהול</title>
    <link rel="stylesheet" href="css/styles.css?v=3">

</head>

<body>
    <div class="dashboard-container">
        <!-- Header - Compact Single Line -->
        <header class="dashboard-header">
            <div class="header-title">
                <img src="icons/logo.png" alt="Logo" class="dashboard-logo">
                <h1>דשבורד ניהול</h1>
            </div>

            <div class="header-controls">
                <!-- בחירת תצוגה לפי צוות -->
                <div class="team-selector-wrapper">
                    <label for="teamSelector" class="team-selector-label">תצוגה:</label>
                    <select id="teamSelector" class="team-selector">
                        <!-- Populated dynamically from teams-structure.json -->
                    </select>
                </div>

                <!-- קובץ דרישות -->
                <div class="drop-zone compact" id="requirementsDropZone" data-type="requirements">
                    <input type="file" id="requirementsInput" accept=".xlsx,.xls,.csv" hidden>
                    <span class="file-status" data-status="empty">דרישות</span>
                </div>

                <!-- קובץ שעות -->
                <div class="drop-zone compact" id="hoursDropZone" data-type="hours">
                    <input type="file" id="hoursInput" accept=".xlsx,.xls,.csv" hidden>
                    <span class="file-status" data-status="empty">שעות</span>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <nav class="tabs">
            <button class="tab-button" data-tab="employees">
                עובדים
            </button>
            <button class="tab-button" data-tab="hours">
                משימות
            </button>
            <button class="tab-button" data-tab="requirements">
                דרישות
            </button>
        </nav>

        <!-- Global Search -->
        <div class="global-search-container">
            <div class="search-box">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="globalSearchInput" class="global-search-input"
                    placeholder="חיפוש עובדים, דרישות, משימות...">
                <button id="clearSearch" class="clear-search-btn" style="display: none;">×</button>
            </div>
            <div id="searchAutocomplete" class="search-autocomplete" style="display: none;"></div>
            <div id="searchResults" class="search-results" style="display: none;"></div>
        </div>

        <!-- Main Content -->
        <main class="dashboard-content">
            <!-- KPI Cards -->
            <section class="summary-section" id="kpiSection">
                <div class="card summary-card" id="kpiEmployeesCard">
                    <div class="card-content">
                        <h3>עובדים</h3>
                        <div class="card-value" id="kpiEmployees">-</div>
                    </div>
                </div>
                <div class="card summary-card" id="kpiTotalHoursCard">
                    <div class="card-content">
                        <h3>סה"כ שעות</h3>
                        <div class="card-value" id="kpiTotalHours">-</div>
                    </div>
                </div>
            </section>

            <!-- Tab: Employees (First) -->
            <section class="tab-content" id="employeesTab">
                <!-- KPI Cards עבור עובדים -->
                <div class="summary-section employees-kpis" id="employeesKpiContainer">
                    <div class="card summary-card clickable-kpi" onclick="window.app && window.app.showAllEmployees()"
                        style="cursor: pointer;" title="לחץ לרשימת כל העובדים">
                        <div class="card-content">
                            <h3>סה"כ עובדים</h3>
                            <div class="card-value" id="totalEmployeesCount">-</div>
                        </div>
                    </div>
                    <div class="card summary-card clickable-kpi"
                        onclick="window.app && window.app.showEmployeesByType('מתף')" style="cursor: pointer;"
                        title="לחץ לרשימת עובדי מתף">
                        <div class="card-content">
                            <h3>עובדי מתף</h3>
                            <div class="card-value" id="matafEmployeesCount">-</div>
                        </div>
                    </div>
                    <div class="card summary-card clickable-kpi"
                        onclick="window.app && window.app.showEmployeesByType('פרויקטלי')" style="cursor: pointer;"
                        title="לחץ לרשימת עובדים פרויקטליים">
                        <div class="card-content">
                            <h3>עובדים פרויקטליים</h3>
                            <div class="card-value" id="projectEmployeesCount">-</div>
                        </div>
                    </div>
                    <div class="card summary-card clickable-kpi"
                        onclick="window.app && window.app.showLowInvestmentEmployees()" style="cursor: pointer;"
                        title="לחץ לרשימת עובדים עם השקעה <65%">
                        <div class="card-content">
                            <h3>השקעה < 65%</h3>
                                    <div class="card-value warning" id="lowInvestmentEmployeesCount">-</div>
                        </div>
                    </div>
                    <div class="card summary-card">
                        <div class="card-content">
                            <h3>שעות השקעה</h3>
                            <div class="card-value" id="investmentHoursKpi">-</div>
                            <div class="card-subvalue" id="investmentHoursPercent">-</div>
                        </div>
                    </div>
                    <div class="card summary-card">
                        <div class="card-content">
                            <h3>שעות הוצאה</h3>
                            <div class="card-value" id="expenseHoursKpi">-</div>
                            <div class="card-subvalue" id="expenseHoursPercent">-</div>
                        </div>
                    </div>
                </div>

                <!-- טבלת עובדים -->
                <div class="card">
                    <div class="filter-bar">
                        <div class="filter-bar-left">
                            <h2 style="margin:0;">פירוט עובדים</h2>
                        </div>
                        <div class="filter-bar-right" style="gap: 5px; display: flex;">
                            <button class="btn btn-icon-only btn-frameless"
                                onclick="window.app && window.app.exportEmployeesExcel()" title="ייצוא לאקסל">
                                <img src="icons/excel.png" alt="Excel">
                            </button>
                            <button class="btn btn-icon-only btn-frameless"
                                onclick="window.app && window.app.exportEmployeesPDF()" title="ייצוא ל-PDF">
                                <img src="icons/pdf.png" alt="PDF">
                            </button>
                            <button class="btn btn-icon-only btn-frameless"
                                onclick="window.app && window.app.exportEmployeesHTML()" title="ייצוא למייל (HTML)">
                                <img src="icons/html.png" alt="HTML">
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="data-table table" id="employeesTable">
                            <thead>
                                <tr>
                                    <th data-sort="name">עובד.ת</th>
                                    <th data-sort="totalHours">סה"כ שעות</th>
                                    <th data-sort="investmentPercent">השקעה %</th>
                                    <th data-sort="expensePercent">הוצאה %</th>
                                    <th data-sort="requirementCount">דרישות בעבודה</th>
                                    <th data-sort="dayCount">ימי עבודה</th>
                                </tr>
                            </thead>
                            <tbody id="employeesTableBody">
                                <tr>
                                    <td colspan="6" class="empty-message">טען קובץ שעות להצגת נתוני עובדים</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Tab: Hours -->
            <section class="tab-content" id="hoursTab">
                <!-- משימות -->
                <div class="card">
                    <div class="filter-bar">
                        <div class="filter-bar-left">
                            <h2 style="margin:0;">משימות</h2>
                        </div>
                        <div class="filter-bar-right" style="gap: 5px; display: flex;">
                            <button class="btn btn-icon-only btn-frameless"
                                onclick="window.app && window.app.exportAllTasksExcel()" title="ייצוא לאקסל">
                                <img src="icons/excel.png" alt="Excel">
                            </button>
                            <button class="btn btn-icon-only btn-frameless"
                                onclick="window.app && window.app.exportAllTasksPDF()" title="ייצוא ל-PDF">
                                <img src="icons/pdf.png" alt="PDF">
                            </button>
                            <button class="btn btn-icon-only btn-frameless"
                                onclick="window.app && window.app.exportAllTasksHTML()" title="ייצוא למייל (HTML)">
                                <img src="icons/html.png" alt="HTML">
                            </button>
                        </div>
                    </div>

                    <div id="tasksCardsContainer" class="tasks-cards-grid">
                        <div class="empty-message" style="padding: 60px;">
                            <div>טען קובץ שעות להצגת משימות</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab: Requirements -->
            <section class="tab-content" id="requirementsTab">
                <!-- New Requirements KPIs -->
                <div id="requirementsKpiContainer" class="summary-section"></div>

                <div class="card">
                    <!-- סרגל סינון לפי סטטוס -->
                    <div class="filter-bar" id="statusFilterBar">
                        <div class="filter-bar-left">
                            <span class="filter-label">סינון:</span>
                            <button class="filter-btn btn btn-sm active" data-status="all">הכל (<span
                                    id="filterCountAll">0</span>)</button>
                            <button class="filter-btn btn btn-sm" data-status="Active">Active (<span
                                    id="filterCountActive">0</span>)</button>
                            <button class="filter-btn btn btn-sm" data-status="Backlog">Backlog (<span
                                    id="filterCountBacklog">0</span>)</button>
                            <button class="filter-btn btn btn-sm" data-status="Done">Done (<span
                                    id="filterCountDone">0</span>)</button>
                            <button class="filter-btn btn btn-sm btn-danger" data-status="overbudget">חריגה (<span
                                    id="filterCountOverbudget">0</span>)</button>
                        </div>
                        <div class="filter-bar-right" style="gap: 5px; display: flex;">
                            <button class="btn btn-icon-only btn-frameless"
                                onclick="window.app && window.app.exportRequirementsExcel()" title="ייצוא לאקסל">
                                <img src="icons/excel.png" alt="Excel">
                            </button>
                            <button class="btn btn-icon-only btn-frameless"
                                onclick="window.app && window.app.exportRequirementsPDF()" title="ייצוא ל-PDF">
                                <img src="icons/pdf.png" alt="PDF">
                            </button>
                            <button class="btn btn-icon-only btn-frameless"
                                onclick="window.app && window.app.exportRequirementsHTML()" title="ייצוא למייל (HTML)">
                                <img src="icons/html.png" alt="HTML">
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="data-table" id="requirementsTable">
                            <thead>
                                <tr>
                                    <th data-sort="id">דרישה</th>
                                    <th data-sort="name">נושא</th>
                                    <th data-sort="budget">תקציב</th>
                                    <th data-sort="actual">הוצאה</th>
                                    <th data-sort="remaining">יתרה</th>
                                    <th data-sort="utilization">ניצול</th>
                                </tr>
                            </thead>
                            <tbody id="requirementsTableBody">
                                <tr>
                                    <td colspan="6" class="empty-message">טען קובץ דרישות להצגת נתונים</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Requirement Details Modal -->
    <div class="modal-overlay" id="requirementModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>פרטי דרישה</h2>
                <button class="modal-close" id="closeRequirementModal">&times;</button>
            </div>
            <div class="modal-body" id="requirementModalBody">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Employee Details Modal -->
    <div class="modal-overlay" id="employeeModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>פרטי עובד</h2>
                <button class="modal-close" id="closeEmployeeModal">&times;</button>
            </div>
            <div class="modal-body" id="employeeModalBody">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Employee List Modal (for KPI clicks) -->
    <div class="modal-overlay" id="employeeListModal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="employeeListModalTitle">רשימת עובדים</h2>
                <button class="modal-close" id="closeEmployeeListModal">&times;</button>
            </div>
            <div class="modal-body" id="employeeListModalBody">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Task Details Modal -->
    <div class="modal-overlay" id="taskModal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="taskModalTitle">פרטי משימה</h2>
                <button class="modal-close" id="closeTaskModal">&times;</button>
            </div>
            <div class="modal-body" id="taskModalBody">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="xlsx.full.min.js"></script>

    <script src="js/vendor/html2canvas.min.js"></script>
    <script src="js/vendor/jspdf.umd.min.js"></script>
    <script src="js/vendor/jspdf.plugin.autotable.min.js"></script>
    <script type="module" src="js/main.js?v=3"></script>
</body>

</html>