<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>דשבורד ניהול</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="font-awesome.min.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header - Compact Single Line -->
        <header class="dashboard-header">
            <div class="header-title">
                <h1>דשבורד ניהול</h1>
            </div>
            
            <div class="header-controls">
                <!-- בחירת תצוגה לפי צוות -->
                <div class="team-selector-wrapper">
                    <label for="teamSelector" class="team-selector-label">תצוגה:</label>
                    <select id="teamSelector" class="team-selector">
                        <option value="all">מנהל מדור</option>
                        <option value="logashi">צוות לוגאשי</option>
                        <option value="spishvili">צוות ספישווילי</option>
                        <option value="retail">צוות ריטל</option>
                        <option value="hoizman">צוות הויזמן</option>
                    </select>
                </div>
                
                <!-- קובץ דרישות -->
                <div class="drop-zone compact" id="requirementsDropZone" data-type="requirements">
                    <input type="file" id="requirementsInput" accept=".xlsx,.xls,.csv" hidden>
                    <span class="file-status" data-status="empty">דרישות</span>
                </div>
                
                <!-- קובץ שעות -->
                <div class="drop-zone compact" id="hoursDropZone" data-type="hours">
                    <input type="file" id="hoursInput" accept=".xlsx,.xls,.csv" hidden>
                    <span class="file-status" data-status="empty">שעות</span>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <nav class="tabs">
            <button class="tab-button active" data-tab="employees">
                עובדים
            </button>
            <button class="tab-button" data-tab="hours">
                דיווחי שעות
            </button>
            <button class="tab-button" data-tab="requirements">
                דרישות
            </button>
        </nav>

        <!-- Global Search -->
        <div class="global-search-container">
            <div class="search-box">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="globalSearchInput" class="global-search-input" placeholder="חיפוש עובדים, דרישות, משימות...">
                <button id="clearSearch" class="clear-search-btn" style="display: none;">×</button>
            </div>
            <div id="searchAutocomplete" class="search-autocomplete" style="display: none;"></div>
            <div id="searchResults" class="search-results" style="display: none;"></div>
        </div>

        <!-- Main Content -->
        <main class="dashboard-content">
            <!-- KPI Cards -->
            <section class="summary-section" id="kpiSection">
                <div class="card summary-card" id="kpiEmployeesCard">
                    <div class="card-content">
                        <h3>עובדים</h3>
                        <div class="card-value" id="kpiEmployees">-</div>
                    </div>
                </div>
                <div class="card summary-card" id="kpiTotalHoursCard">
                    <div class="card-content">
                        <h3>סה"כ שעות</h3>
                        <div class="card-value" id="kpiTotalHours">-</div>
                    </div>
                </div>
            </section>

            <!-- Tab: Employees (First) -->
            <section class="tab-content active" id="employeesTab">
                <!-- KPI Cards עבור עובדים -->
                <div class="summary-section employees-kpis">
                    <div class="card summary-card clickable-kpi" onclick="window.app && window.app.showAllEmployees()" style="cursor: pointer;" title="לחץ לרשימת כל העובדים">
                        <div class="card-content">
                            <h3>סה"כ עובדים</h3>
                            <div class="card-value" id="totalEmployeesCount">-</div>
                        </div>
                    </div>
                    <div class="card summary-card clickable-kpi" onclick="window.app && window.app.showEmployeesByType('מתף')" style="cursor: pointer;" title="לחץ לרשימת עובדי מתף">
                        <div class="card-content">
                            <h3>עובדי מתף</h3>
                            <div class="card-value" id="matafEmployeesCount">-</div>
                        </div>
                    </div>
                    <div class="card summary-card clickable-kpi" onclick="window.app && window.app.showEmployeesByType('פרויקטלי')" style="cursor: pointer;" title="לחץ לרשימת עובדים פרויקטליים">
                        <div class="card-content">
                            <h3>עובדים פרויקטליים</h3>
                            <div class="card-value" id="projectEmployeesCount">-</div>
                        </div>
                    </div>
                    <div class="card summary-card clickable-kpi" onclick="window.app && window.app.showLowInvestmentEmployees()" style="cursor: pointer;" title="לחץ לרשימת עובדים עם השקעה <65%">
                        <div class="card-content">
                            <h3>השקעה < 65%</h3>
                            <div class="card-value warning" id="lowInvestmentEmployeesCount">-</div>
                        </div>
                    </div>
                    <div class="card summary-card">
                        <div class="card-content">
                            <h3>שעות השקעה</h3>
                            <div class="card-value" id="investmentHoursKpi">-</div>
                            <div class="card-subvalue" id="investmentHoursPercent">-</div>
                        </div>
                    </div>
                    <div class="card summary-card">
                        <div class="card-content">
                            <h3>שעות הוצאה</h3>
                            <div class="card-value" id="expenseHoursKpi">-</div>
                            <div class="card-subvalue" id="expenseHoursPercent">-</div>
                        </div>
                    </div>
                </div>

                <!-- טבלת עובדים -->
                <div class="card">
                    <div class="filter-bar">
                        <div class="filter-bar-left">
                            <h2 style="margin:0;">פירוט עובדים</h2>
                        </div>
                        <div class="filter-bar-right">
                            <button class="btn btn-export" onclick="window.app && window.app.exportEmployeesExcel()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                אקסל
                            </button>
                            <button class="btn btn-export" onclick="window.app && window.app.exportEmployeesPDF()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table table" id="employeesTable">
                            <thead>
                                <tr>
                                    <th data-sort="name">עובד.ת</th>
                                    <th data-sort="totalHours">סה"כ שעות</th>
                                    <th data-sort="investmentPercent">השקעה %</th>
                                    <th data-sort="expensePercent">הוצאה %</th>
                                    <th data-sort="requirementCount">דרישות בעבודה</th>
                                    <th data-sort="dayCount">ימי עבודה</th>
                                </tr>
                            </thead>
                            <tbody id="employeesTableBody">
                                <tr>
                                    <td colspan="6" class="empty-message">טען קובץ שעות להצגת נתוני עובדים</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Tab: Hours -->
            <section class="tab-content" id="hoursTab">
                <!-- KPI Cards עבור שעות -->
                <div class="summary-section hours-kpis">
                    <div class="card summary-card">
                        <div class="card-content">
                            <h3>סה"כ משימות</h3>
                            <div class="card-value" id="totalTasks">-</div>
                        </div>
                    </div>
                    <div class="card summary-card">
                        <div class="card-content">
                            <h3>עמוסות (4+ אנשים)</h3>
                            <div class="card-value warning" id="overloadedTasks">-</div>
                        </div>
                    </div>
                    <div class="card summary-card">
                        <div class="card-content">
                            <h3>משימות השקעה</h3>
                            <div class="card-value" id="investmentTasks">-</div>
                        </div>
                    </div>
                    <div class="card summary-card">
                        <div class="card-content">
                            <h3>משימות הוצאה</h3>
                            <div class="card-value" id="expenseTasks">-</div>
                        </div>
                    </div>
                </div>

                <!-- מפת חום משימות -->
                <div class="card">
                    <h2>מפת חום - משימות</h2>
                    <div id="matrixView" class="matrix-container">
                        <div class="empty-message" style="padding: 60px;">
                            <div>מפת החום תיטען כאן...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab: Requirements -->
            <section class="tab-content" id="requirementsTab">
                <div class="card">
                    <!-- סרגל סינון לפי סטטוס -->
                    <div class="filter-bar" id="statusFilterBar">
                        <div class="filter-bar-left">
                            <span class="filter-label">סינון:</span>
                            <button class="filter-btn btn btn-sm active" data-status="all">הכל (<span id="filterCountAll">0</span>)</button>
                            <button class="filter-btn btn btn-sm" data-status="Active">Active (<span id="filterCountActive">0</span>)</button>
                            <button class="filter-btn btn btn-sm" data-status="Backlog">Backlog (<span id="filterCountBacklog">0</span>)</button>
                            <button class="filter-btn btn btn-sm" data-status="Done">Done (<span id="filterCountDone">0</span>)</button>
                            <button class="filter-btn btn btn-sm btn-danger" data-status="overbudget">חריגה (<span id="filterCountOverbudget">0</span>)</button>
                        </div>
                        <div class="filter-bar-right">
                            <button class="btn btn-export" onclick="window.app && window.app.exportRequirementsExcel()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                אקסל
                            </button>
                            <button class="btn btn-export" onclick="window.app && window.app.exportRequirementsPDF()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                                PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table" id="requirementsTable">
                            <thead>
                                <tr>
                                    <th data-sort="id">דרישה</th>
                                    <th data-sort="name">נושא</th>
                                    <th data-sort="budget">תקציב</th>
                                    <th data-sort="actual">הוצאה</th>
                                    <th data-sort="remaining">יתרה</th>
                                    <th data-sort="utilization">ניצול</th>
                                </tr>
                            </thead>
                            <tbody id="requirementsTableBody">
                                <tr>
                                    <td colspan="6" class="empty-message">טען קובץ דרישות להצגת נתונים</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Requirement Details Modal -->
    <div class="modal-overlay" id="requirementModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>פרטי דרישה</h2>
                <button class="modal-close" id="closeRequirementModal">&times;</button>
            </div>
            <div class="modal-body" id="requirementModalBody">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Employee Details Modal -->
    <div class="modal-overlay" id="employeeModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>פרטי עובד</h2>
                <button class="modal-close" id="closeEmployeeModal">&times;</button>
            </div>
            <div class="modal-body" id="employeeModalBody">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Employee List Modal (for KPI clicks) -->
    <div class="modal-overlay" id="employeeListModal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="employeeListModalTitle">רשימת עובדים</h2>
                <button class="modal-close" id="closeEmployeeListModal">&times;</button>
            </div>
            <div class="modal-body" id="employeeListModalBody">
                <!-- Content will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="xlsx.full.min.js"></script>
    <script src="chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>

